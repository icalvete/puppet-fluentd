<source>
  type syslog
  port <%= @remote_port %>
  bind 0.0.0.0
  tag sp
  format /^(?<time>[^ ]*\s*[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?[^\:]*\: *:(?<environment>.*)::(?<application>[a-zA-Z0-9_\/\.\-]*)::(?<operation>.*?):\s(?<message>.*)$/
</source>


<match sp.local4.*>
  type copy

  <store>
    type 		file
    path 		/var/log/td-agent/sp_l4
    time_slice_format 	%Y%m%d
    time_slice_wait 	10m
    time_format 	%Y%m%dT%H%M%S%z
    compress 		gzip
    utc
   </store>

  <store>
    type		elasticsearch
    host		<%= scope.lookupvar('fluentd::td-agent::elasticsearch_host') %>
    port 		9200
    logstash_format 	true
    flush_interval      5s
  </store>
 </match>


<match sp.local5.*>
  type copy

  <store>
    type 		file
    path 		/var/log/td-agent/sp_l5
    time_slice_format 	%Y%m%d
    time_slice_wait 	10m
    time_format 	%Y%m%dT%H%M%S%z
    compress 		gzip
    utc
   </store>

  <store>
    type		elasticsearch
    host		<%= scope.lookupvar('fluentd::td-agent::elasticsearch_host') %>
    port 		9200
    logstash_format 	true
    flush_interval      5s
  </store>
 </match>
